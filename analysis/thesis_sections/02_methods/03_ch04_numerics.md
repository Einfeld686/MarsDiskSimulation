## 4. 数値計算法

<!--
実装(.py): marsdisk/run_zero_d.py, marsdisk/run_one_d.py, marsdisk/physics/smol.py, marsdisk/physics/collisions_smol.py, marsdisk/physics/surface.py, marsdisk/physics/viscosity.py, marsdisk/io/checkpoint.py, marsdisk/io/streaming.py
-->

本章では，粒径分布の離散化と時間積分の具体形を整理し，計算が破綻しやすい点（非負性の破れと質量収支のずれ）を，どのような判定と刻み制御で抑えているかを明確にする．とくに本研究では，衝突破砕が粒径分布を強く駆動する一方で，放射圧ブローアウトや追加シンクが系外流出を与えるため，「何が保存され，何が失われるのか」を数値的にも追跡できる形で実装しておくことが不可欠である．

### 4.1 離散化

粒径 $s$ の空間は対数等間隔のビンで離散化し，$k$ 番目のビン中心を $s_k$，ビン境界を $s_{k-1/2},\,s_{k+1/2}$ とする．連続分布 $n(s)=\mathrm{d}N/\mathrm{d}s$（単位 $\mathrm{m}^{-3}$ ではなく，面密度としての $\mathrm{m}^{-2},\mathrm{m}^{-1}$ を想定）に対して，状態量 $N_k$ はビン内の数密度（面数密度）として

\[
N_k \equiv \int_{s_{k-1/2}}^{s_{k+1/2}} n(s)\,\mathrm{d}s
\]

で定義する．このとき，粒子の質量 $m_k$ を代表粒径 $s_k$ における球近似で $m_k=(4\pi/3)\rho s_k^3$ とおけば，表層の面密度は $\Sigma_{\rm surf}=\sum_k m_k N_k$ で与えられる．以後，衝突による「損失」は $N_k$ を減らす効果，「生成」は $N_k$ を増やす効果としてビン上で評価する．

計算の粒径範囲は下限 $s_{\min}$ と上限 $s_{\max}$ により与え，$s_{\min}\le s \le s_{\max}$ を「数値的に解像する領域」とみなす．ただし下限側は，放射圧によって束縛軌道を維持できない粒子が存在するため，有効下限

\[
s_{\min,\rm eff}(t)\equiv \max\!\left(s_{\min},\,s_{\rm blow}(t)\right)
\]

を導入する．ここで $s_{\rm blow}(t)$ はその時刻のブローアウト粒径である（定義は第3節）．実装上は粒径格子そのものを時刻ごとに張り替えるのではなく，$s\lesssim s_{\rm blow}$ の領域を一次シンクとして除去することで，結果として $s_{\min,\rm eff}$ 未満が系に留まりにくい状態を再現する．この $s_{\min,\rm eff}$ は，供給粒子をどのビンに注入するか等の「境界条件」としても働くため，下限の扱いを明示しておくことが再現性に直結する．

上限 $s_{\max}$ より大きい成分は，衝突破砕によって短時間に形成される「未解像の大粒子」ではなく，むしろ外部供給や深部リザーバとして代表化したい成分である．そこで本研究では，$s_{\max}$ を超える粒子を直接追跡せず，その影響は供給項 $F_k$（第\ref{sec:method-supply}節）として粒径分布へ注入する近似を採る．この近似は，上限側での詳細形状を捨てる代わりに，表層の粒径分布が放射圧と衝突破砕で決まる領域に計算資源を集中させる意図を持つ．

半径方向は第1節で定義したセル分割に従い，セルごとに局所量（$\Sigma_{\rm surf}$，$\tau_{\rm los}$，供給率など）を更新しつつ，粒径分布の進化を計算する．本章で述べる時間積分は，各セルにおける粒径分布の局所進化（衝突・供給・シンク）に対して適用される．

### 4.2 数値解法と停止条件

#### 採用スキームの位置づけ

衝突破砕の支配方程式（Smoluchowski 型の連立常微分方程式）は，粒径ビン数が増えるほど剛性が強くなり，とくに小粒径側で衝突頻度が高い場合に，陽的時間積分は刻み制約を受けやすい．実際，デブリ円盤やデブリディスクの文脈では，一次の Euler 法と可変刻み制御により時間発展を追う実装が報告されている\citep{Thebault2003_AA408_775,Krivov2006_AA455_509}．一方で，定常解や長時間スケールを効率よく求めるため，陰的スキームを用いる実装も採られている\citep{Birnstiel2011_AA525_A11}．

本研究で必要なのは，(i) 衝突による損失が大きい領域でも $N_k\ge 0$ を維持でき，(ii) 衝突過程それ自体の質量保存を破らない範囲で，供給とシンクを加えた質量収支を追跡でき，(iii) 放射圧による急速な損失（ブローアウト）とも整合的に結合できることである．そこで，衝突損失のみを陰的に扱い，生成・供給・一次シンクを陽的に扱う IMEX（implicit–explicit）型の一次 BDF（BDF(1)）を採用する．この分割は，「発散しやすい（剛性の強い）項」に限定して陰解法を用い，残りは見通しのよい陽解法で扱うという，実装と検証の両面でバランスのよい選択である．

#### 更新式（IMEX-BDF(1)）

$N_k^n$ を時刻 $t^n$ における $k$ ビンの数密度（面数密度）とする．衝突カーネル $C_{ij}$ と破片再配分テンソルから，衝突による生成項 $G_k^n$ と損失時定数 $t_{{\rm coll},k}^n$ を評価し，さらに供給項 $F_k^n$ と一次シンク $S_k^n$（ブローアウト，昇華，追加シンク等の合算）を加える．このとき，IMEX-BDF(1) による更新は次式で与える：

\begin{equation}
\label{eq:imex_bdf1_update}
N_k^{n+1}=\frac{N_k^{n}+dt_{\rm eff}\left(G_k^{n}+F_k^{n}-S_k^{n}N_k^{n}\right)}{1+dt_{\rm eff}/t_{{\rm coll},k}^{n}}.
\end{equation}

ここで $dt_{\rm eff}$ はこの更新で実際に用いる内部ステップ幅である．分母の項が衝突損失の陰的取り扱いに対応し，$dt_{\rm eff}\gtrsim t_{{\rm coll},k}$ の場合でも $N_k^{n+1}$ が負に落ちにくい形になっている．一方，$G_k$ と $F_k$ は陽的に入るため，時間刻みが過大であれば過剰生成により非負性を破る可能性が残る．したがって本研究では，次節で述べるように「非負性」と「質量収支」の二重の判定により $dt_{\rm eff}$ を制御する．

$t_{{\rm coll},k}$ は，衝突カーネルが与える単位面積当たりの衝突頻度から，$k$ ビン粒子 1 個あたりの損失率に換算した量で定義する．具体的には，$k$ ビン粒子が他の全ビンと衝突する頻度を $N_k$ で割った量を損失係数とみなし，その逆数として衝突時定数を得る．この定義は，「$t_{{\rm coll},k}$ が短いほど $k$ ビン粒子が速く失われる」という直観と一致し，時間刻み制御にも自然に用いられる．

#### 時間刻み制御

外側の時間刻み $\Delta t$ は，温度曲線 $T_M(t)$ の与え方（第3節）や，ブローアウト時定数 $t_{\rm blow}$ を含む物理過程の変化を解像できるように設定する．ただし，粒径分布の更新では，$\Delta t$ のまま式\ref{eq:imex_bdf1_update}を適用すると非負性や質量収支が破れる場合がある．そこで，粒径分布の更新には内部ステップ幅 $dt_{\rm eff}\le \Delta t$ を導入し，まず

\[
dt_{\rm eff}\leftarrow \min\!\left(\Delta t,\, f_{\rm safe}\min_k t_{{\rm coll},k}\right)
\]

を初期値として与える．ここで $f_{\rm safe}$ は安全率であり，本研究では $f_{\rm safe}=0.1$ を用いる．この初期値は，衝突時定数が最も短いビンを基準に「衝突損失の剛性」を避けるための経験的な基準である．

そのうえで，$dt_{\rm eff}$ を用いて式\ref{eq:imex_bdf1_update}を一度評価し，(i) いずれかのビンで $N_k^{n+1}<0$ が生じる，あるいは (ii) 次節で定義する質量収支誤差 $\epsilon_{\rm mass}$ が許容値を超える場合には，$dt_{\rm eff}\leftarrow dt_{\rm eff}/2$ として同じ外側ステップ内で再計算する．この「半減による受理判定」を，非負性と質量収支の両方が満たされるまで繰り返し，最終的に受理された $dt_{\rm eff}$ をそのセルの粒径分布更新に採用する．

ここで強調しておきたいのは，この刻み制御が単なる数値安定化に留まらず，モデルの前提（たとえば「衝突過程は質量保存的である」）を数値的にも守るための実装上の約束になっている点である．とくに本研究では，放射圧や追加シンクによって系外へ質量が流出するため，「どの程度の質量が衝突で再配分され，どの程度が系外へ出たのか」を毎ステップで検査できることが結果の信頼性を支える．

### 4.3 質量保存の検査と停止条件

#### 質量収支誤差の定義

衝突項（$G_k$ と $t_{{\rm coll},k}$ で表される損失）だけを取り出せば，破片再配分が正しく実装されている限り，理想的には質量は保存される．しかし実際には，(i) 生成項が陽的であること，(ii) ブローアウトや追加シンクが陽的に入ること，(iii) 有限精度計算の丸め誤差が累積することにより，離散化された系では「微小だが無視できない」収支ずれが生じ得る．そこで本研究では，各内部ステップごとに次の形で質量収支誤差を定義し，時間刻み受理の判定に用いる：

\begin{equation}
\label{eq:mass_budget_definition}
\begin{aligned}
\Sigma^{n} &= \sum_k m_k N_k^{n}, & \Sigma^{n+1} &= \sum_k m_k N_k^{n+1},\\
\Delta\Sigma &= \Sigma^{n+1} + dt_{\rm eff}\,\dot{\Sigma}_{\rm extra} - \left(\Sigma^{n} + dt_{\rm eff}\,\dot{\Sigma}_{\rm in}\right),\\
\epsilon_{\rm mass} &= \frac{|\Delta\Sigma|}{\Sigma^{n}}.
\end{aligned}
\end{equation}

ここで $\dot{\Sigma}_{\rm in}$ は外部供給による面密度注入率であり，第\ref{sec:method-supply}節で与えた供給モデルに基づいて $F_k$ を構成したときの $\dot{\Sigma}_{\rm in}=\sum_k m_k F_k$ に対応する．一方，$\dot{\Sigma}_{\rm extra}$ はブローアウト，昇華，追加シンクなど，陽的に扱う一次損失の合算である．この定義により，「衝突再配分は質量保存的であり，供給は系へ質量を加え，シンクは系から質量を奪う」という期待が，離散化後の更新でも満たされているかを，$dt_{\rm eff}$ のスケールで直接点検できる．

本研究では，$\epsilon_{\rm mass}\le 5\times10^{-3}$（相対誤差 0.5%）を受理基準とし，この条件を満たさない場合は前節の手順に従って $dt_{\rm eff}$ を半減する．なお，$\dot{\Sigma}_{\rm extra}$ はステップ開始時の分布 $N_k^n$ に基づいて評価し，陽的に扱う損失と整合する形で収支を検査する．

#### 停止条件

計算全体の時間積分は，火星表面温度 $T_M$ が所定の閾値 $T_{\rm end}$ に到達する時刻を終端 $t_{\rm end}$ として定義する．本論文では $T_{\rm end}=2000,\mathrm{K}$ を採用し，高温期に対応する時間帯に解析対象を絞る．この設定は，「放射圧による表層質量損失が顕著になる条件」を外さない範囲で計算時間を制御する意図を持つ．

加えて，各半径セルには早期停止条件を設ける．本研究の表層モデルは，火星放射が表層に到達して粒子温度や放射圧を決めるという近似の上に立っているため，有効光学的厚さ（本研究では視線方向の $\tau_{\rm los}$ を用いる）が大きくなると，この近似は破綻する．そこで，セルごとに

\[
\tau_{\rm los} > \tau_{\rm stop}
\]

を満たした時点でそのセルの粒径分布更新を停止し，以後は本モデルの適用範囲外として扱う．本論文では透過率 $\exp(-\tau_{\rm los})$ が $0.1$ 以下となる目安として $\tau_{\rm stop}=\ln 10$ を採用する．ここでの「停止」は円盤の物理的停止を意味しない．あくまで，そのセルに対して「火星放射が表層へ到達する」という仮定が成立しなくなったことを示す数値的なフラグである．

さらに，ブローアウト粒径が格子下限を下回る状況（$s_{\rm blow}\le s_{\min}$）が継続する場合には，供給・損失の境界条件が実質的に変わるため，設定に応じて早期終了とする（この条件を有効化するかは表\ref{tab:method-param}の設定に従う）．これらの停止条件により，積分期間を物理的に意味のある高温期へ合わせると同時に，適用範囲外の領域で数値解を延命させることを避ける．

補助的に，数値計算の効率化のため，全円盤の流出率 $\dot{M}_{\rm out}$ が十分小さく，式\ref{eq:mass_loss_update}で更新される $M_{\rm loss}$ の増分が無視できる状態が継続する場合には，それ以後の時間積分を打ち切る設定も用いる．これは「物理的に円盤が停止する」ことを意味せず，累積損失の評価（$M_{\rm loss}(t_{\rm end})$）に実質的な寄与がない尾部を省略して計算時間を短縮するための手続きである．
