このファイルは、Claude がこのリポジトリ内で作業するときの「ローカル補足ガイド」です。

* AI エージェント全体のルール、完了条件、DocSyncAgent の手順は `AGENTS.md` を正とします。
* 出力は日本語で行ってください。
* AI ドキュメント編集全般のルールは `analysis/AI_USAGE.md` を正とします。
* このファイルでは、とくに **SVG スライド生成** に関する Claude 向けの追加指示だけを記載します。
* 追加の更新や修正が必要な場合は、原則として `AGENTS.md` 側を更新し、ここは参照ポインタと Claude 専用の最小限の補足にとどめます。

---

## 1. プロジェクト前提

このリポジトリは、火星ロッシュ限界内のガスがほとんど無い衝突起源ダスト円盤を、時間だけの一次元（0 次元）モデルとして発展させるコードです。sub-blow-out 粒子の供給と、放射圧による剥離を扱います。

主なエントリーポイントは次のとおりです。

* `analysis/overview.md`
  モデル全体の説明。ブロック図や導出の入口。
* `analysis/equations.md`
  すべての式と記号の定義。

  * 数式・記号の**唯一のソース**です（式番号例: `E.001`, `F1–F2`）。
* `analysis/slides_outline.md`
  スライド構成。必須スライド 10 枚が `slide_id` 付きで定義されています。
* `analysis/run_catalog.md`
  `RUN:...` ラベルと `out/...` ディレクトリの対応。
* `analysis/figures_catalog.md`
  `FIG:...` ラベルと図生成スクリプト、依存 run の対応。
* `analysis/glossary.md`
  用語集。聴衆レベルや数式の要否タグ付き。
* `analysis/literature_map.md`
  Hyodo+2017/2018, Ronnet+2016, Canup & Salmon 2018 など主要論文との対応表。

コード側の主なディレクトリ構成は次のとおりです。

* `marsdisk/`
  物理モデル本体（放射圧、粒径分布、遮蔽、Smoluchowski、表層常微分方程式など）。
* `configs/`
  実行設定ファイル（`base.yml` など）。
* `out/`
  実行結果（Parquet, JSON など）。
  個々の run のメタデータは `out/<timestamp>.../run_card.md` を正とします。

---

## 2. 共通ルール（equations / ラベル / AI 編集）

### 2.1 数式と記号

1. 新しい式や記号を導入するときは、必ず `analysis/equations.md` を参照して、既存記号との衝突を避けます。
2. スライドやテキストに式を載せるときは、**`equations.md` にある式をそのまま引用**し、式番号を明示します。
   例: 「式 E.013 参照」のように書く。
3. `analysis/` 配下の他ファイルに、式そのものを再定義しないでください。必要なら式番号で参照します。

### 2.2 ラベルとカタログ

1. run 参照は `RUN:...`、図は `FIG:...`、文献は `REF:...` 形式のラベルを使います。
2. ラベルの意味と一意性は次を正とします。

   * `analysis/run_catalog.md`（RUN）
   * `analysis/figures_catalog.md`（FIG）
   * `analysis/literature_map.md`（REF）
3. カタログに存在しないラベルを勝手に新設しないでください。
   新設が必要そうな場合は、`analysis/AI_USAGE.md` の **UNKNOWN_REF_REQUESTS** 方針に従い、「提案」にとどめます（実際の追加は人間が行う前提）。

### 2.3 AI によるドキュメント編集

1. `analysis/` 配下を編集・生成するときは、`equations.md` の式をコピーして改変しないでください。

   * 式の変更や新設は、必ず人間が `equations.md` を編集する前提です。
2. 数式や参照を追加・変更した場合は、ユーザーによる DocSync、doc テスト、`evaluation_system` 実行が必要になる想定です。
   Claude はそれらの実行までを自動化しようとせず、「ここまで行ったら人間の確認が必要」という所までで止めます。
3. AI エージェント全般の詳細ルール（ラベル命名など）は、必ず `analysis/AI_USAGE.md` を参照してください。

---

## 3. Claude 専用ワークフロー: SVG スライド生成

このリポジトリでは、Claude から「人間（リポジトリオーナー）が読む技術スライド」を **SVG 形式で出力**させます。

* 想定読者はこのリポジトリのオーナー 1 人です。

  * 数式や専門用語の使用は前提とします。
  * 同じ内容を別の比喩で二重に説明しないでください。
  * 「全体像が一望できること」と、「コード・式・代表 run・図の対応関係がはっきり見えること」を重視します。

### 3.1 スライド生成前のコンテキスト確認

「スライドを作る」タスクを受けた Claude は、次の順番でファイルを読みます。

1. `analysis/slides_outline.md`（必須、最初に読む）

   * `slide_id`, `title`, `goal`（そのスライドで何を理解したいか）、`eq_refs`, `fig_refs`, `run_refs` などの列を持つ前提です。
   * **必須フラグ付きの 10 スライド**を、最小構成のスライドデッキとして扱います。
2. `analysis/overview.md`, `analysis/equations.md`

   * モデル全体の構造と、式・記号の定義をここから取得します。
   * `slides_outline.md` の `eq_refs` に列挙された式番号に対応する式を、`equations.md` から参照します。
3. `analysis/run_catalog.md`, `analysis/figures_catalog.md`

   * `run_refs` に書かれた `RUN:...` から、対応する config や `out/...` ディレクトリを特定します。
   * `fig_refs` に書かれた `FIG:...` から、載せるべき図や指標の意味と生成スクリプトを把握します。
4. `analysis/glossary.md`, `analysis/literature_map.md`

   * 必要な用語の簡潔な説明と、Hyodo+2018 など関連論文の位置づけを確認します。

上記を読んだうえで、各スライドの役割・紐づく式・紐づく run / 図を整理してから SVG を組み立てます。

### 3.2 スライド内容の構成方針

1 枚のスライドは、基本的に次の要素を持ちます（必要に応じて省略・追加可）。

1. タイトル
2. 3〜5 行程度の本文

   * このスライドの要点を短くまとめることを優先します。
3. 関連する式番号の列挙

   * 例: `E.013, E.021` のように式番号だけを並べる。
   * 可能であれば、その式が何を表しているかを 1 行で自然文にまとめます。
4. 関連する run / 図のラベル

   * 例: `RUN:BASE_COOLING`, `FIG:COOLING_TIMESCALE_VS_R` など。

重要なのは、各スライドが「どの式」「どの run / 図」と結びついているかを明示することです。
背景説明を長く書くよりも、対応関係が読み取りやすい構造を優先します。

### 3.3 SVG 出力仕様

Claude がスライドを生成するときは、**テキストのみから成る SVG を 1 スライド 1 ファイル**の形式で出力します。

1. 各スライドは 1 つの `<svg>` 要素とし、最低限つぎの属性を必須とします。

   ```svg
   <svg xmlns="http://www.w3.org/2000/svg"
        width="1920" height="1080"
        viewBox="0 0 1920 1080"
        data-slide-id="SLIDE_ID_HERE">
     <!-- text elements only -->
   </svg>
   ```

   * `data-slide-id` には、`analysis/slides_outline.md` の `slide_id` をそのまま入れます。
   * 位置指定などはシンプルな `<text>` 要素の組み合わせでよく、図形要素は原則不要です。

2. 1 つのタスクで複数スライドを生成する場合でも、**1 SVG = 1 スライド**を守り、ファイルごとに `data-slide-id` を変えます。

3. 数式は、可能であれば簡略表現（ASCII 近似）で書き、式番号で厳密な定義に戻れるようにします。
   LaTeX の完全埋め込みは必須ではなく、優先度は「式番号との対応 > 見た目の整形」です。a

---

## 4. 優先順位と今後の更新

* AI エージェント全般のルールと完了条件: `AGENTS.md` を正とします。
* AI によるドキュメント編集ルール・UNKNOWN_REF_REQUESTS など: `analysis/AI_USAGE.md` を正とします。
* 本ファイルは「Claude がこのリポジトリで SVG スライドを生成するときの補足ガイド」としてのみ使います。

参照先の構成変更や、Claude に固有の制約が変わった場合だけ、本ファイルを更新してください。
