# tools ディレクトリ運用指針

`tools/` はシミュレーション結果を可視化・診断する補助スクリプトを置くディレクトリです。本書では配置や命名、入出力の基本ルールのみを定めます。各スクリプトの詳細な説明や使用手順は `analysis/tools/visualizations.md` を参照してください。

## 1. 適用範囲
- 可視化・解析を目的とした Python スクリプトのみを配置すること。
- 数値モデルや運用ユーティリティは `marsdisk/` や `marsdisk/ops/`、試験的コードは `prototypes/` へ配置する。
- サブディレクトリを追加する場合は役割を明確にし、README なしで把握できる命名にする。

## 2. 入力規則
- 既存の出力形式（Parquet, CSV, JSON, JSONL, HDF5）を優先的に使用し、新形式を導入する際は分析ドキュメントで合意を得る。
- ファイルパスの既定値はリポジトリ直下ではなく `simulation_results/` または `figures/` 配下の新規フォルダを指すこと。
- CLI からの引数は `argparse` で明示的に定義し、必須・任意を区別する。boolean は `--flag/--no-flag` など明示的に切り替え可能にする。

## 3. 保存規則
- 生成物は既存ディレクトリを汚染しないよう日時付きディレクトリもしくはユーザー指定パスへ保存する。
- 画像は PNG もしくは MP4/GIF で保存し、dpi や圧縮率などの再現性に関わるパラメータをログ出力する。
- 実行時に必要なテーブルや補助ファイルはリポジトリ内の参照パスを記録し、重複コピーを作成しない。

## 4. 実装ポリシー
- `matplotlib` を利用する場合は `matplotlib.use("Agg", force=True)` をスクリプト冒頭で呼び、ヘッドレス環境でも動作させる。
- 乱数を使う場合はシードを引数で受け取れるようにし、デフォルト値を固定する。
- 例外は標準の `ValueError` / `KeyError` 等を用いてユーザーに不足情報を伝える。
- 大規模処理を行う際は進捗ログを INFO レベルで出力し、`logging` の基本設定は関数化して再利用する。

## 5. レビューと更新
- 新たな可視化を追加した際は `analysis/tools/visualizations.md` に入出力の概要を追記する。
- 既存スクリプトのインタフェースを変更する場合は後方互換性を確認し、CLI オプションの非推奨化期間を設ける。
- 本書の内容を更新する場合は、README など他ドキュメントとの整合性を確認した上で最小限の記述に留める。
